{% set translationDomain = "overview" %}
{% trans_default_domain translationDomain %}

{% set is102 = report.type == constant('AppBundle\\Entity\\Report\\Report::TYPE_102') %}
{% set is103 = report.type == constant('AppBundle\\Entity\\Report\\Report::TYPE_103') %}
{% set is104 = report.type == constant('AppBundle\\Entity\\Report\\Report::TYPE_104') %}

<ul id="overview-sections" class="overview-sections">

    <li id="planning-section" class="overview-section">
        <h2 class="heading">{{ 'heading.decisionsContacts' | trans() }}</h2>
        {% include 'AppBundle:Report/Overview:_subsection.html.twig' with {
            transDomain: translationDomain,
            subSection: 'decisions',
            report: report,
            description: true,
            state: reportStatus.decisionsState,
            nOfRecords: report.decisions | length,
            list: true
        } %}
        {% include 'AppBundle:Report/Overview:_subsection.html.twig' with {
            transDomain: translationDomain,
            subSection: 'contacts',
            report: report,
            description: true,
            list: true,
            info: true,
            state: reportStatus.contactsState,
            nOfRecords: report.contacts | length,
        } %}
    </li>

    <li id="welfare-section" class="overview-section">
        <h2 class="heading">{{ 'heading.healthAndWelfare' | trans() }}</h2>
        {% include 'AppBundle:Report/Overview:_subsection.html.twig' with {
            transDomain: translationDomain,
            subSection: 'visits_care',
            report: report,
            info: true,
            description: true,
            state: reportStatus.visitsCareState
        } %}
    </li>

    {% if is102 or is103 %}
        <li id="finances-section" class="overview-section">
            <h2 class="heading">{{ 'heading.propFinance' | trans() }}</h2>
            {% if report.isDue() and not reportStatus.balanceMatches %}

                <div class="error alert push-half--ends" id="cannot-submit-warning">
                    <span class="icon icon__notification"></span>
                    <div class="alert-message">
                        <p class="flush--bottom">Your accounts are not balanced.<br>
                        <a href="{{ path('balance', {'reportId': report.id}) }}" class="behat-link-balance-view-details">View details</a></p>
                    </div>
                </div>

            {% endif %}


            {% include 'AppBundle:Report/Overview:_subsection.html.twig' with {
                transDomain: translationDomain,
                subSection: 'bank_accounts',
                report: report,
                state: reportStatus.bankAccountsState,
                nOfRecords: report.bankAccounts | length,
                warning: true,
                description: true
            } %}
            {% if is102 %}
                {% include 'AppBundle:Report/Overview:_subsection.html.twig' with {
                    transDomain: translationDomain,
                    subSection: 'money_transfers',
                    report: report,
                    state: reportStatus.moneyTransferState,
                    nOfRecords: report.moneyTransfers | length,
                    warning: true,
                    description: true
                } %}
                {% endif %}
            {% include 'AppBundle:Report/Overview:_subsection.html.twig' with {
                transDomain: translationDomain,
                subSection: 'money_in',
                report: report,
                state: reportStatus.moneyInState,
                nOfRecords: report.transactionsIn | length,
                warning: true,
                description: true
            } %}
            {% include 'AppBundle:Report/Overview:_subsection.html.twig' with {
                transDomain: translationDomain,
                subSection: 'money_out',
                report: report,
                state: reportStatus.moneyOutState,
                nOfRecords: report.transactionsOut | length,
                warning: true,
                description: true
            } %}
            {# show balance section only for editing, when an explanation is given #}
            {% if report.balanceMismatchExplanation %}
                {% include 'AppBundle:Report/Overview:_subsection.html.twig' with {
                    transDomain: translationDomain,
                    subSection: 'balance',
                    report: report,
                    state: reportStatus.balanceState,
                    warning: true,
                    description: true
                } %}
            {% endif %}
            {% include 'AppBundle:Report/Overview:_subsection.html.twig' with {
                transDomain: translationDomain,
                subSection: 'assets',
                report: report,
                state: reportStatus.assetsState,
                nOfRecords: report.assets | length,
                list: true,
                description: true
            } %}
            {% include 'AppBundle:Report/Overview:_subsection.html.twig' with {
            transDomain: translationDomain,
            subSection: 'debts',
            report: report,
            state: reportStatus.debtsState,
            nOfRecords: report.debtsWithValidAmount | length,
            list: true,
            description: true
            } %}
        </li>
    {% endif %}


    <li id="report-submit-section" class="overview-section">
        <h2 class="heading">{{ 'heading.other' | trans() }}</h2>
        {% include 'AppBundle:Report/Overview:_subsection.html.twig' with {
            transDomain: translationDomain,
            subSection: 'actions',
            report: report,
            description: true,
            state: reportStatus.actionsState,
            list: true
        } %}

        {% if reportStatus.isReadyToSubmit and report.isDue %}
            {% include 'AppBundle:Report/Overview:_subsection.html.twig' with {
                transDomain: translationDomain,
                subSection: 'report_add_further_info',
                report: report,
                description: false,
                state: "not-started",
                status: "Not started"
            } %}
        {%  else %}
            {% include 'AppBundle:Report/Overview:_subsection.html.twig' with {
                transDomain: translationDomain,
                subSection: 'report_add_further_info',
                report: report,
                description: false,
                state: "not-started",
                status: "Not started",
                disableedit: true
            } %}
        {%  endif %}
    </li>
</ul>

{% if report.isDue == true and reportStatus.isReadyToSubmit == false %}
    {% include 'AppBundle:Components/Page:_page-section-warning.html.twig' with {
        transDomain: translationDomain,
        pageSectionWarning: 'submitWhenReady',
        iconClass: 'icon icon__notification',
        id: 'cannot-submit-warning'
    } %}
{% endif %}


{% if report.isDue == false %}
    {% set endDate = report.getEndDate() | date(" d F Y")  %}
    {% include 'AppBundle:Components/Page:_page-section-warning.html.twig' with {
    transDomain: translationDomain,
    pageSectionWarning: 'warningNotDue',
    transOptions: {'%date%': endDate},
    iconClass: 'icon icon__notification',
    id: 'cannot-submit-warning'
    } %}
{% endif %}
