{# @param report AppBundle\Entity\Report #}
{# @param client AppBundle\Entity\Client #}
{% set translationDomain = "report-overview" %}
{% trans_default_domain translationDomain %}
{% set transOptions = {'%client%': client.firstname | e } %}
{% set sectionId = sectionId | default(null) %}
{% set sectionNeedsAttention = report.isSectionFlaggedForAttention(sectionId) %}

{% if linkToSubSection is not defined %}
    {% set linkToSubSection = path(subSection, {reportId: report.id}) %}
{% endif %}

<div id="{{ subSection }}-sub-section" class="section-list-item {{ sectionNeedsAttention ? ('behat-region-section-' ~ sectionId ~ '-needs-attention highlight') : '' }}">

    <a href="{{ linkToSubSection }}" class="edit-heading-link">
        <h3 class="heading heading-medium">{{ (subSection ~ '.subSectionTitle') | trans }}</h3>
    </a>
    <span class="govuk-tag {{ state.state | status_to_tag_css }} behat-region-{{ subSection }}-state-{{ state.state }}">
        {% if state.state == 'done' or customiseAllLabels | default(false) %}
            {{ (subSection ~ '.label.' ~ state.state) | transchoice(state.nOfRecords | default(0)) }}
        {% else %}
            {{ ('labels.' ~ state.state) | trans }}
        {% endif %}
    </span>

    <a class="edit-link behat-link-edit-{{ subSection }}" id="edit-{{ subSection }}" href="{{ linkToSubSection }}">
        {% if subSection == 'balance' %}
            {{ 'view' | trans({}, 'common') | capitalize }}
        {% else %}
            {% if state.state == 'not-started' %}
                {{ 'start' | trans({}, 'common') | capitalize }}
            {% else %}
                {{ 'edit' | trans({}, 'common') | capitalize }}
            {% endif %}
        {% endif %}
    </a>

    {%  if description | default(false) %}
        <p class="description text flush--bottom">
            {% if descriptionRaw | default(false)  %}
                {{ descriptionRaw | raw }}
            {% else %}
                {{ (subSection ~ '.subSectionDescription') | trans(transOptions) }}
            {% endif %}
        </p>
    {%  endif %}
    {%  if descriptionLink | default(false) %}
        <p class="description">
            <a href="{{ linkToSubSection }}#cantFindTheProblem">{{ (subSection ~ '.subSectionDescription.' ~ descriptionLinkAction ~ 'Explanation') | trans(transOptions) }}</a>
        </p>
    {% endif %}
</div>
