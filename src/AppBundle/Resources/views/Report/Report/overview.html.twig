{% extends 'AppBundle:Layouts:application.html.twig' %}

{% import 'AppBundle:Macros:macros.html.twig' as macros %}

{% set translationDomain = "report-overview" %}
{% trans_default_domain translationDomain %}
{% set transOptions = {'%client%': report.client.firstname | e } %}

{# TODO REPLACE those two using report.hasSection() #}
{% block htmlTitle %}{{ 'htmlTitle' | trans }}{% endblock %}
{% block pageTitle %}{% endblock %}

{% block pageContent %}

    {% block pageHeader %}
        {% include 'AppBundle:Report/Report:_header.html.twig' %}
    {% endblock %}

    <div class="grid-row">
        <div class="column-one-half">
            <ul>
                <li>{{ 'reportingPeriod' | trans() }}:
                    <span class="bold-small">{{ report.startDate | date(" d F Y") }} to {{ report.endDate | date(" d F Y") }}</span>
                </li>
                <li>{{ 'dueDate' | trans() }}:
                    <span class="bold-small">{{ report.dueDate | date(" d F Y") }}</span>
                </li>
                <li>Report status:
                    <span class="bold-small">{{ ('status.' ~ reportStatus.status) | trans() }}</span>
                </li>
            </ul>
        </div>

        <div class="column-one-half">
            <a class="button right" href="{{ path('report_review', {'reportId': report.id}) }}">Review report</a>
        </div>
    </div>

    <div class="push--top">
        {{ macros.notification('info', 'guidanceNotice' | trans) }}
    </div>


    <ul id="overview-sections" class="overview-sections">

        <li id="planning-section" class="overview-section">
            <h2 class="heading">{{ 'heading.decisionsContacts' | trans() }}</h2>
            {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                transDomain: translationDomain,
                subSection: 'decisions',
                report: report,
                description: true,
                state: reportStatus.decisionsState,
                list: true
            } %}
            {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                transDomain: translationDomain,
                subSection: 'contacts',
                report: report,
                description: true,
                list: true,
                info: true,
                state: reportStatus.contactsState,
            } %}
        </li>

        <li id="welfare-section" class="overview-section">
            <h2 class="heading">{{ 'heading.healthAndWelfare' | trans(transOptions) }}</h2>
            {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                transDomain: translationDomain,
                subSection: 'visits_care',
                report: report,
                info: true,
                description: true,
                state: reportStatus.visitsCareState
            } %}
            {% if report.hasSection('lifestyle') %}
                {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                transDomain: translationDomain,
                subSection: 'lifestyle',
                report: report,
                info: true,
                description: true,
                state: reportStatus.lifestyleState
                } %}
            {% endif %}
        </li>


        {% if report.hasSection('paDeputyExpense') or report.hasSection('deputyExpense') or report.hasSection('bankAccounts') %}
            <li id="finances-section" class="overview-section">
                <h2 class="heading push-half--bottom">{{ 'heading.propFinance' | trans(transOptions) }}</h2>
                {% if report.isDue() and not reportStatus.balanceMatches %}
                    {{ macros.notification('error', 'balance.notBalancedWarning' | trans({'%detailsLink%': path('balance', {'reportId': report.id}) })) }}
                {% endif %}

                {% if report.hasSection('paDeputyExpense') %}
                    {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                    transDomain: translationDomain,
                    subSection: 'pa_fee_expense',
                    report: report,
                    state: reportStatus.paFeesExpensesState,
                    linkToSubSection: path('pa_fee_expense', {'reportId': report.id}),
                    description: true
                    } %}
                {% endif %}
                {% if report.hasSection('deputyExpense') %}
                    {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                        transDomain: translationDomain,
                        subSection: 'deputy_expenses',
                        report: report,
                        state: reportStatus.expensesState,
                        linkToSubSection: path('deputy_expenses', {'reportId': report.id}),
                        description: true
                    } %}
                {% endif %}

                {% if report.hasSection('gifts') %}
                    {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                    transDomain: translationDomain,
                    subSection: 'gifts',
                    report: report,
                    state: reportStatus.giftsState,
                    linkToSubSection: path('gifts', {'reportId': report.id}),
                    description: true
                    } %}
                {% endif %}

                {% if report.hasSection('bankAccounts') %}
                    {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                        transDomain: translationDomain,
                        subSection: 'bank_accounts',
                        report: report,
                        state: reportStatus.bankAccountsState,
                        warning: true,
                        description: true
                    } %}
                {% endif %}
                {% if report.hasSection('moneyTransfers') %}
                    {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                        transDomain: translationDomain,
                        subSection: 'money_transfers',
                        report: report,
                        state: reportStatus.moneyTransferState,
                        warning: true,
                        description: true
                    } %}
                    {% endif %}
                {% if report.hasSection('moneyIn') and if report.hasSection('moneyOut') %}
                    {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                    transDomain: translationDomain,
                    subSection: 'money_in',
                    report: report,
                    state: reportStatus.moneyInState,
                    warning: true,
                    description: true
                    } %}
                    {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                    transDomain: translationDomain,
                    subSection: 'money_out',
                    report: report,
                    state: reportStatus.moneyOutState,
                    warning: true,
                    description: true
                    } %}
                {% endif %}
                {% if report.hasSection('moneyInShort') and if report.hasSection('moneyOutShort') %}
                    {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                    transDomain: translationDomain,
                    subSection: 'money_in_short',
                    report: report,
                    state: reportStatus.MoneyInShortState,
                    warning: true,
                    description: true
                    } %}
                    {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                    transDomain: translationDomain,
                    subSection: 'money_out_short',
                    report: report,
                    state: reportStatus.MoneyOutShortState,
                    warning: true,
                    description: true
                    } %}
                {% endif %}
                {# show balance section only for editing, when an explanation is given #}
                {% if report.hasSection('balance') and report.balanceMismatchExplanation %}
                    {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                        transDomain: translationDomain,
                        subSection: 'balance',
                        report: report,
                        state: reportStatus.balanceState,
                        warning: true,
                        description: true
                    } %}
                {% endif %}
                {% if report.hasSection('assets') %}
                    {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                        transDomain: translationDomain,
                        subSection: 'assets',
                        report: report,
                        state: reportStatus.assetsState,
                        list: true,
                        description: true
                    } %}
                {% endif %}
                {% if report.hasSection('debts') %}
                    {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                    transDomain: translationDomain,
                    subSection: 'debts',
                    report: report,
                    state: reportStatus.debtsState,
                    list: true,
                    description: true
                    } %}
                {% endif %}
            </li>
        {% endif %}


        <li id="report-submit-section" class="overview-section">
            <h2 class="heading">{{ 'heading.other' | trans() }}</h2>
            {% if report.hasSection('actions') %}
                {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                    transDomain: translationDomain,
                    subSection: 'actions',
                    report: report,
                    description: true,
                    state: reportStatus.actionsState,
                    list: true
                } %}
            {% endif %}
            {% if report.hasSection('actions') %}
                {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                    transDomain: translationDomain,
                    subSection: 'other_info',
                    linkToSubSection: path('other_info', {reportId: report.id}),
                    report: report,
                    info: true,
                    description: true,
                    state: reportStatus.otherInfoState,
                } %}
            {% endif %}

        <li id="report-submit-section" class="overview-section">
            <h2 class="heading">{{ 'heading.caseDocuments' | trans() }}</h2>
            {% if report.hasSection('actions') %}
                {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                    transDomain: translationDomain,
                    subSection: 'documents',
                    report: report,
                    description: true,
                    state: reportStatus.documentsState,
                    list: true
                } %}
            {% endif %}

            {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                transDomain: translationDomain,
                subSection: 'report_submit',
                linkToSubSection: path('report_review', {reportId: report.id}),
                report: report,
                description: false,
                state: reportStatus.submitState,
                disableedit: reportStatus.submitState.state != 'done'
            } %}
        </li>
    </ul>

    {# report due but NOT ready to submit #}
    {% if report.isDue and not reportStatus.isReadyToSubmit %}
        {{ macros.notification('notice', 'submitWhenReady' | trans()) }}
    {% endif %}

    {# report is NOT due #}
    {% if not report.isDue %}
        {% set endDate = report.getEndDate() | date(" d F Y")  %}
        {% set transOptions = {'%date%': endDate} %}
        {{ macros.notification('notice', 'warningNotDue' | trans(transOptions)) }}
    {% endif %}

{% endblock %}
