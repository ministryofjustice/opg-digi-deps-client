{% extends 'AppBundle:Layouts:application.html.twig' %}

{% import 'AppBundle:Macros:macros.html.twig' as macros %}

{% set translationDomain = "report-overview" %}
{% trans_default_domain translationDomain %}
{% set transOptions = {'%client%': report.client.firstname | e } %}

{% block htmlTitle %}{{ 'htmlTitlePA' | trans }}{% endblock %}
{% block pageTitle %}{% endblock %}

{% block pageContent %}

    {% block pageHeader %}
        {% include 'AppBundle:Pa/ClientProfile:_header.html.twig' %}
    {% endblock %}

    <div class="panel panel-admin hard">
        <div class="panel-heading">
            <h2 class="heading-medium flush--bottom push--right">{{ 'currentReport' | trans() }}</h2>
            {% if report.hasSection('balance') %}
                {% if report.isDue() and report.showBalanceWarning %}
                    <div class="alert alert-important">
                        <span class="icon icon-important-small"></span>
                        <div class="alert-message">
                            <p class="font-small">
                                {{ ('balance.notBalancedWarningPA') | trans }}
                            </p>
                        </div>
                    </div>
                {% endif %}
            {% endif %}
        </div>
        <div class="panel-body soft-half">
            <div class="grid-row">
                <div class="column-one-half">
                    <dl class="push--bottom">
                        <dt>
                            <strong class="bold">{{ 'reportStatus' | trans() }}</strong>
                        </dt>
                        <dd class="push--bottom">
                            <span class="status status-large {{ reportStatus.getState() }} flush--bottom">
                                {{ ('status.' ~ reportStatus.status) | trans() }}
                            </span>
                        </dd>

                        <dt class="visually-hidden">
                            <strong class="bold">{{ 'reportOptions' | trans() }}</strong>
                        </dt>
                        <dd class="push--bottom">
                            <a href="{{ path('report_review', {'reportId': report.id}) }}">{{ 'options.viewReport' | trans() }}</a><br>
                            {% if report.submitted == false and reportStatus.isReadyToSubmit and report.isDue %}
                                <p class="push--top">
                                    <a class="behat-link-edit-report_submit button" id="edit-report_submit" href="{{ path('report_review', {'reportId': report.id}) }}">{{ 'options.submitReport' | trans() }}</a>
                                </p>
                            {% endif %}
                        </dd>
                    </dl>
                </div>

                <div class="column-one-half">
                    <dl class="push--bottom">
                        <dt>
                            <strong class="bold">{{ 'reportingPeriod' | trans() }}</strong>
                        </dt>
                        <dd class="push--bottom">
                            <span class="push--right">{{ report.startDate | date(" d F Y") }} to {{ report.endDate | date(" d F Y") }}</span>
                            <a href="{{ path('report_edit', {'reportId': report.id}) }}" class="right behat-link-edit-report-period">{{ 'edit' | trans }}</a>
                        </dd>

                        <dt>
                            <strong class="bold">{{ 'reportDueDate' | trans() }}</strong>
                        </dt>
                        <dd class="push--bottom">
                            {{ report.dueDate | date(" d F Y") }}<br>
                            {% if report.dueDateDiffDays < 0 %}
                                <span class="font-xsmall bold text-red">Overdue by {{ report.dueDateDiffDays|abs }} days</span>
                            {% elseif report.dueDateDiffDays == 0 %}
                                <span class="font-xsmall bold">Due today</span>
                            {% elseif report.dueDateDiffDays <= 30 %}
                                <span class="font-xsmall">Due in {{ report.dueDateDiffDays }} days</span>
                            {% endif %}
                        </dd>
                    </dl>
                </div>

            </div>

            <p>
                <strong class="bold">{{ 'reportSectionsToComplete' | trans() }}</strong>
            </p>

            <div id="overview-sections" class="push--bottom">

                <div class="grid-row">
                    <div class="column-one-half">
                        <ul>
                            {% if report.hasSection('decisions') %}
                                {% include 'AppBundle:Pa/ClientProfile:_subsection.html.twig' with {
                                    transDomain: translationDomain,
                                    subSection: 'decisions',
                                    report: report,
                                    description: true,
                                    state: reportStatus.decisionsState,
                                    list: true
                                } %}
                            {% endif %}

                            {% if report.hasSection('contacts') %}
                                {% include 'AppBundle:Pa/ClientProfile:_subsection.html.twig' with {
                                    transDomain: translationDomain,
                                    subSection: 'contacts',
                                    report: report,
                                    description: true,
                                    list: true,
                                    info: true,
                                    state: reportStatus.contactsState,
                                } %}
                            {% endif %}

                            {% if report.hasSection('visitsCare') %}
                                {% include 'AppBundle:Pa/ClientProfile:_subsection.html.twig' with {
                                    transDomain: translationDomain,
                                    subSection: 'visits_care',
                                    report: report,
                                    info: true,
                                    description: true,
                                    state: reportStatus.visitsCareState
                                } %}
                            {% endif %}

                            {% if report.hasSection('lifestyle') %}
                                {% include 'AppBundle:Pa/ClientProfile:_subsection.html.twig' with {
                                    transDomain: translationDomain,
                                    subSection: 'lifestyle',
                                    report: report,
                                    info: true,
                                    description: true,
                                    state: reportStatus.lifestyleState
                                    } %}
                            {%  endif %}

                            {% if report.hasSection('paDeputyExpenses') %}
                                {% include 'AppBundle:Pa/ClientProfile:_subsection.html.twig' with {
                                    transDomain: translationDomain,
                                    subSection: 'pa_fee_expense',
                                    report: report,
                                    state: reportStatus.paFeesExpensesState,
                                    linkToSubSection: path('pa_fee_expense', {'reportId': report.id}),
                                    description: true
                                } %}
                            {%  endif %}

                            {% if report.hasSection('gifts') %}
                                {% include 'AppBundle:Pa/ClientProfile:_subsection.html.twig' with {
                                    transDomain: translationDomain,
                                    subSection: 'gifts',
                                    report: report,
                                    state: reportStatus.giftsState,
                                    linkToSubSection: path('gifts', {'reportId': report.id}),
                                    description: true
                                } %}
                            {% endif %}

                            {% if report.hasSection('actions') %}
                                {% include 'AppBundle:Pa/ClientProfile:_subsection.html.twig' with {
                                    transDomain: translationDomain,
                                    subSection: 'actions',
                                    report: report,
                                    description: true,
                                    state: reportStatus.actionsState,
                                    list: true
                                } %}
                            {% endif %}

                            {% if report.hasSection('otherInfo') %}
                                {% include 'AppBundle:Pa/ClientProfile:_subsection.html.twig' with {
                                    transDomain: translationDomain,
                                    subSection: 'other_info',
                                    linkToSubSection: path('other_info', {reportId: report.id}),
                                    report: report,
                                    info: true,
                                    description: true,
                                    state: reportStatus.otherInfoState,
                                } %}
                            {% endif %}

                        </ul>
                    </div>

                    <div class="column-one-half">
                        <ul>

                            {% if report.hasSection('bankAccounts') %}
                                {% include 'AppBundle:Pa/ClientProfile:_subsection.html.twig' with {
                                    transDomain: translationDomain,
                                    subSection: 'bank_accounts',
                                    report: report,
                                    state: reportStatus.bankAccountsState,
                                    warning: true,
                                    description: true
                                } %}

                                {% if report.isDue() and report.showBalanceWarning %}
                                    <li id="bank_accounts_not_balanced-section" class="section-list-item">
                                        <div id="bank_accounts_not_balanced-sub-section">
                                            {{ macros.notification('important', 'balance.notBalancedWarningPAWithLink' | trans({'%detailsLink%': path('balance', {'reportId': report.id}) })) }}
                                        </div>
                                    </li>
                                {% endif %}
                            {% endif %}

                            {% if report.hasSection('moneyTransfers') %}
                                {% include 'AppBundle:Pa/ClientProfile:_subsection.html.twig' with {
                                    transDomain: translationDomain,
                                    subSection: 'money_transfers',
                                    report: report,
                                    state: reportStatus.moneyTransferState,
                                    warning: true,
                                    description: true
                                    } %}
                            {% endif %}

                            {% if report.hasSection('moneyIn') and report.hasSection('moneyOut') %}
                                {% include 'AppBundle:Pa/ClientProfile:_subsection.html.twig' with {
                                    transDomain: translationDomain,
                                    subSection: 'money_in',
                                    report: report,
                                    state: reportStatus.moneyInState,
                                    warning: true,
                                    description: true
                                } %}
                                {% include 'AppBundle:Pa/ClientProfile:_subsection.html.twig' with {
                                    transDomain: translationDomain,
                                    subSection: 'money_out',
                                    report: report,
                                    state: reportStatus.moneyOutState,
                                    warning: true,
                                    description: true
                                } %}
                            {% endif %}
                            {% if report.hasSection('moneyInShort') and report.hasSection('moneyOutShort') %}
                                {% include 'AppBundle:Pa/ClientProfile:_subsection.html.twig' with {
                                    transDomain: translationDomain,
                                    subSection: 'money_in_short',
                                    report: report,
                                    state: reportStatus.MoneyInShortState,
                                    warning: true,
                                    description: true
                                } %}
                                {% include 'AppBundle:Pa/ClientProfile:_subsection.html.twig' with {
                                    transDomain: translationDomain,
                                    subSection: 'money_out_short',
                                    report: report,
                                    state: reportStatus.MoneyOutShortState,
                                    warning: true,
                                    description: true
                                } %}
                            {% endif %}

                            {% if report.hasSection('assets') %}
                                {% include 'AppBundle:Pa/ClientProfile:_subsection.html.twig' with {
                                    transDomain: translationDomain,
                                    subSection: 'assets',
                                    report: report,
                                    state: reportStatus.assetsState,
                                    list: true,
                                    description: true
                                } %}
                            {% endif %}

                            {% if report.hasSection('debts') %}
                                {% include 'AppBundle:Pa/ClientProfile:_subsection.html.twig' with {
                                    transDomain: translationDomain,
                                    subSection: 'debts',
                                    report: report,
                                    state: reportStatus.debtsState,
                                    list: true,
                                    description: true
                                } %}
                            {% endif %}

                            {% if report.hasSection('documents') %}
                                {% include 'AppBundle:Pa/ClientProfile:_subsection.html.twig' with {
                                    transDomain: translationDomain,
                                    subSection: 'documents',
                                    report: report,
                                    state: reportStatus.documentsState,
                                    list: true,
                                    description: true
                                } %}
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% include 'AppBundle:Pa/ClientProfile:_notes.html.twig' with {
    notes: report.client.notes,
    } %}

    {% include 'AppBundle:Pa/ClientProfile:_contacts.html.twig' with {
    contacts: report.client.clientContacts,
    } %}

    {% include 'AppBundle:Pa/ClientProfile:_reports.html.twig' with {
    reports: report.client.reports,
    } %}

    {% include 'AppBundle:Pa/ClientProfile:_client.html.twig' with {
    client: report.client,
    } %}

{% endblock %}
