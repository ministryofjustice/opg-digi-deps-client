{% extends 'AppBundle:Layouts:application.html.twig' %}

{% import 'AppBundle:Macros:macros.html.twig' as macros %}

{% set isNamedOrAdmin = (app.user.roleName == 'ROLE_PA' or app.user.roleName == 'ROLE_PA_ADMIN') %}

{% block htmlTitle %}User accounts{% endblock %}
{% block pageTitle %}User accounts{% endblock %}
{% block pageTitleClass %}heading-large{% endblock %}

{% block breadcrumbs %}
    [breadcrumbs]
    {#{{ macros.breadcrumbsSettings('home') }}#}
{% endblock %}

{% block helpline %}{% endblock %}

{% block pageContent %}
    {# Introduction text #}
    <p class="text">
        {% if isNamedOrAdmin %}
            Add, edit and remove user accounts for you and your team members
        {% else %}
            View team members and edit your account
        {% endif %}
    </p>

    <div class="grid-row push--top">
        <div class="column-half">
            <h2 class="heading-medium flush--ends">List of user accounts</h2>
        </div>
        {% if canAddPaUsers %}
        <div class="column-half text--right">
            {% if isNamedOrAdmin %}
            <a href="{{ path('add_team_member') }}"
               class="bold-small move-quarter--up action-link behat-link-add">
                <span class="icon icon-plus"></span>
                Add user account
            </a>
            {% endif %}
        </div>
        {% endif %}

    </div>

    <table class="check-your-answers">
        <thead>
            <tr>
                <th>Name and job</th>
                <th>Contact information</th>
                <th>
                    <span class="visuallyhidden">Actions</span>
                </th>
            </tr>
        </thead>

        <tbody>
        {% for user in teamMembers %}
            {% set allowedToEdit = app.user.roleName == 'ROLE_PA'
            or (app.user.roleName == 'ROLE_PA_ADMIN' and user.roleName != 'ROLE_PA')
            or app.user.id == user.id %}
            <tr class="behat-region-team-user-{{ user.email | behat_namify }}">
                <td valign="top" class="width-third">
                    <p class="flush--ends">
                        <strong class="bold">{{ user.firstname }} {{ user.lastname }}</strong>
                    </p>
                    {% if user.roleName == 'ROLE_PA' or user.roleName == 'ROLE_PA_ADMIN' %}
                        <span class="status status-label admin">Administrator</span><br>
                    {% endif %}
                    {% if user.jobTitle != '' %}
                    <p class="flush--top">{{ user.jobTitle }}</p>
                    {% endif %}
                    <span class="visuallyhidden">
                        active: {{ user.active ?'yes':'no' }} |
                    </span>
                </td>
                <td>
                    <p class="flush--ends">
                        <strong class="bold">Email</strong><br>
                        {{ user.email }}
                    </p>
                    {% if user.phoneMain != '' %}
                    <p class="flush--bottom push-half--top">
                        <strong class="bold">Phone</strong><br>
                        {{ user.phoneMain }}
                    </p>
                    {% endif %}
                </td>
                <td class="change-answer">
                    {% if allowedToEdit %}
                        <a class="behat-link-edit" href="{{  path('edit_team_member', {'id': user.id}) }}">Edit</a>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

{% endblock %}
