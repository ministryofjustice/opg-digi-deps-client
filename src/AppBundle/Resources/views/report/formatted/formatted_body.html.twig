{% set client = report.client %}
{% set assets = report.assets %}
{% set debts = report.debts %}
{% set contacts = report.getContacts %}
{% set decisions = report.getDecisions %}
{% set isEmailAttachment = true %}
{% set team = app.user.teams | first %}
{% set transfers = report.getMoneyTransfers %}
{% set mentalCapacity = report.getMentalCapacity %}
{% set transOptions = {'%client%': report.client.firstname | e } %}
{% set reportTypeHeading = ('-4' == report.get104TransSuffix) ? 'property and financial, and health and welfare' : ('104' in report.type) ? 'health and welfare' : 'property and financial'  %}

{# "default(app.user)" is left only to avoid breaking the page before the migration (that adds user.submittedBy) is executed  #}
{% set submittedBy = report.submittedBy | default(app.user) %}

<style type="text/css" media="screen, print">
    {% include 'AppBundle:css:formatted-report.css.twig' %}
</style>
<div id="wrapper">
    <div class="formatted-report">

        <div id="report-header">Office of the Public Guardian</div>
        <h1 class="push--bottom">Deputy report for {{ reportTypeHeading }} decisions</h1>

        {% include 'AppBundle:report/formatted:_client_information.html.twig' %}

        {# Show the summary (key info) when a flag is set from the controller (only submit time for OPG),
           and when the money/balance information are present (only 102 reports ATM) #}
        {% if showSummary | default(false) and report.hasSection('balance')  %}
            {% include 'AppBundle:report/formatted:_report_summary.html.twig' %}
        {% endif %}

        {% include 'AppBundle:report/formatted:_decisions.html.twig' %}
        {% if report.mentalCapacity is not null %}
            {% include 'AppBundle:report/formatted:_mental-capacity.html.twig' with {
            'mentalCapacity': report.mentalCapacity
            } %}
        {% endif %}
        {% include 'AppBundle:report/formatted:_contacts.html.twig' %}
        {% if report.visitsCare is not null %}
            {% include 'AppBundle:report/formatted:_visits_care.html.twig' with {
            'visitsCare': report.visitsCare
            } %}
        {% endif %}
        {% if report.hasSection('lifestyle') %}
            {% include 'AppBundle:report/formatted:_lifestyle.html.twig' with {
                'lifestyle': report.lifestyle
            } %}
        {% endif %}

        {% include 'AppBundle:report/formatted:_assets.html.twig' %}
        {% include 'AppBundle:report/formatted:_debts.html.twig' %}

        {% if report.hasSection('moneyIn') %}
            <div class="section break-before" id="accounts-section">
                {% if (report.bankAccounts | length) > 0 %}
                    <h2 class="section-heading">Accounts</h2>
                    {% if report.totalsMatch %}
                        {% include 'AppBundle:report/formatted:accounts/_good.html.twig' %}
                    {% else %}
                        {% include 'AppBundle:report/formatted:accounts/_bad.html.twig' with {
                            'showReason': true
                        } %}
                    {% endif %}

                    {% include 'AppBundle:report/formatted:accounts/_summary.html.twig' %}
                    {% include 'AppBundle:report/formatted:accounts/_transfers.html.twig' %}
                {% endif %}
                {% include 'AppBundle:report/formatted:accounts/_money_in_out.html.twig' %}
            </div>
        {% endif %}

        {% if report.hasSection('moneyInShort') %}
            <div class="section" id="accounts-section">
                {% if report.bankAccounts | length > 0 %}
                    <h2 class="section-heading">Accounts</h2>
                    {% include 'AppBundle:report/formatted:accounts/_summary.html.twig' %}
                {% endif %}
                {% include 'AppBundle:report/formatted:accounts/_money_in_out_short.html.twig' with {
                'title': 'Money in',
                'categories': report.moneyShortCategoriesInPresent,
                'transactions': report.moneyTransactionsShortIn,
                'transactionsExist': report.moneyTransactionsShortInExist,
                'transactionsTitle': 'Items of income over £1,000',
                'existQuestion' : 'Have there been any items of income over £1,000? ',
                'totalText': 'Money in total (items over £1,000)'
                } %}
                {% include 'AppBundle:report/formatted:accounts/_money_in_out_short.html.twig' with {
                'title': 'Money out',
                'categories': report.moneyShortCategoriesOutPresent,
                'transactions': report.moneyTransactionsShortOut,
                'transactionsExist': report.moneyTransactionsShortOutExist,
                'transactionsTitle': 'Expenses over £1,000',
                'existQuestion' : 'Have there been any one-off items of expense over £1,000? ',
                'totalText': 'Money out total (items over £1,000)'
                } %}
            </div>
        {% endif %}

        {% if report.hasSection('paDeputyExpenses') %}
            {% include 'AppBundle:report/formatted:_pa_fee_expenses.html.twig' %}
        {% endif %}
        {% if report.hasSection('deputyExpenses') %}
            {% include 'AppBundle:report/formatted:_expenses.html.twig' %}
        {% endif %}

        {% if report.hasSection('profCurrentFees') %}
            {% include 'AppBundle:report/formatted:_prof_current_fees.html.twig' %}
        {% endif %}

        {% if report.hasSection('profDeputyCosts') %}
            {% include 'AppBundle:report/formatted:_prof_deputy_costs.html.twig' %}
        {% endif %}

        {% if report.hasSection('profDeputyCostsEstimate') %}
            {% include 'AppBundle:report/formatted:_prof_deputy_costs_estimate.html.twig' %}
        {% endif %}        

        {% include 'AppBundle:report/formatted:_gifts.html.twig' %}

        {% if report.hasSection('balance') %}
            {% include 'AppBundle:report/formatted:accounts/_final_summary.html.twig' %}
        {% endif %}

        {% if report.hasSection('actions') %}
            {% include 'AppBundle:report/formatted:_action.html.twig' %}
        {% endif %}

        {% include 'AppBundle:report/formatted:_any_other_info.html.twig' with {
            'title': 'Is there anything you’d like to tell us that hasn’t been covered elsewhere in your report?',
        } %}

        {% include 'AppBundle:report/formatted:_attached_documents.html.twig' with {
        'title': 'Would you like to upload supporting documentation?',
        } %}
        <div class="section" id="declaration">
            {% include 'AppBundle:report/formatted:_submission_declaration.html.twig' %}
        </div>
    </div>
</div>
